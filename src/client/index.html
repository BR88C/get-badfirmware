<!DOCTYPE html>
<html lang="en">
<!-- https://github.com/BR88C/get-badfirmware -->

<head>
    <!-- Document Setup -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Set website metadata -->
    <title>Get Badfirmware</title>
    <meta name="description" content="Get some firmware!">
    <meta name="theme-color" content="#FFB233">
    <meta property="og:title" content="Get Badfirmware">
    <meta property="og:description" content="Get some firmware!">
    <meta property="og:image" content="/firmware.png">
    <meta property="og:image:alt" content="Firmware">
    <link rel="icon" type="image/webp" sizes="256x256" href="/favicon.webp">

    <!-- Styles -->
    <style>
        body {
            overflow: hidden;
            margin: 0;
            background-color: black;
        }

        .start-btn {
            width: 40%;
            margin-top: 10%;
            margin-left: 30%;
            padding: 2vh;
            border-radius: 1vh;
            border-color: transparent;
            font-size: 3vh;
            font-weight: 700;
            cursor: pointer;
        }

        .disclaimer {
            position: absolute;
            bottom: 0;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 1.4vh;
        }

        .glowup-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <button id="start-btn" class="start-btn">Click to get firmware!</button>

    <video id="glowup-video" class="glowup-video" style="visibility: hidden;">
        <source src="/glowup.mp4" type="video/mp4" />
    </video>

    <script>
        (async () => {
            try {
                const ipInfo = await (await fetch(`${window.origin}/data`)).json();
                if (ipInfo.status !== `success`) throw new Error(ipInfo.message);

                let webGL, webGLDebugInfo;
                const canvas = document.createElement(`canvas`);
                try {
                    webGL = canvas.getContext(`webgl`) ?? canvas.getContext(`experimental-webgl`);
                    webGLDebugInfo = webGL?.getExtension(`RENDERER`) ?? webGL?.getExtension(`WEBGL_debug_renderer_info`);
                } catch (error) {}

                const stage1Data = [
                    ['IP', ipInfo.query],
                    ['ISP', ipInfo.isp],
                    ['ORG', ipInfo.org],
                    ['Autonomous System', ipInfo.asname ?? ipInfo.as],
                    ['Mobile', ipInfo.mobile],
                    ['Proxy', ipInfo.proxy],
                    ['Hosting', ipInfo.hosting],
                    ['User Agent', ipInfo.agent],
                    ['Local UA', window.navigator?.userAgent],
                    ['Language Headers', ipInfo.acceptLang],
                    ['Cookies Enabled', !!window.navigator?.cookieEnabled],
                ];

                const stage2Data = [
                    ['Continent', ipInfo.continent ?? ipInfo.continentCode],
                    ['Country', ipInfo.country ?? ipInfo.countryCode],
                    ['Region', ipInfo.regionName ?? ipInfo.region],
                    ['City', ipInfo.city],
                    ['Zip Code', ipInfo.zip],
                    ['Lat', ipInfo.lat],
                    ['Lon', ipInfo.lon],
                    ['Timezone', ipInfo.timezone],
                    ['Local Time', new Date().toLocaleTimeString()],
                    ['Currency', ipInfo.currency],
                    ['Enabled Languages', window.navigator?.languages?.join(`, `) ?? `en-US`],
                    ['OS', window.navigator?.oscpu ?? window.navigator?.platform ?? `<Unknown>`],
                    ['CPU Threads', window.navigator?.hardwareConcurrency ?? 1],
                    ['Memory', `${window.navigator?.deviceMemory ?? (performance.memory?.jsHeapSizeLimit ?? 0) / (1024 ** 3)  ?? `<Unknown>`}Gb`],
                    ['Heap Size Limit', `${(performance.memory?.jsHeapSizeLimit ?? 0) / 1024}Kb`],
                    ['GPU Vendor', webGLDebugInfo ? webGL?.getParameter(webGLDebugInfo.UNMASKED_VENDOR_WEBGL) ?? `<Unknown>` : `<Unknown>`],
                    ['GPU Info', webGLDebugInfo ? webGL?.getParameter(webGLDebugInfo.UNMASKED_RENDERER_WEBGL) ?? `<Unknown>` : `<Unknown>`],
                    ['Touch Enabled', window.navigator?.maxTouchPoints > 0],
                    ['Battery', typeof window.navigator?.getBattery === `function` ? `${((await window.navigator.getBattery()).level ?? 1) * 100}%` : `Unavailable`]
                ];

                const startBtn = document.getElementById(`start-btn`);
                const glowupVideo = document.getElementById(`glowup-video`);

                startBtn.addEventListener(`click`, async () => {
                    startBtn.style.visibility = `hidden`;
                    glowupVideo.style.visibility = `visible`;

                    glowupVideo.play();
                });
            } catch (error) {
                console.error(error);
            }
        })();
    </script>
</body>

</html>
